<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Drag & Drop —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤</title>
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }
        
        .inventory-container {
            max-width: 800px;
            margin: 0 auto;
            background: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #333;
        }
        
        .inventory-section {
            margin-bottom: 20px;
        }
        
        .inventory-section h3 {
            margin: 0 0 10px 0;
            color: #ccc;
            font-size: 16px;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .inventory-slot {
            width: 60px;
            height: 60px;
            border: 2px solid #333;
            border-radius: 8px;
            background: #2a2a2a;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }
        
        .inventory-slot:hover {
            border-color: #555;
        }
        
        .inventory-slot.filled {
            background: #3a3a3a;
            border-color: #666;
        }
        
        .inventory-slot.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        
        .inventory-slot.drag-over {
            border-color: #ff6b35;
            background: rgba(255, 107, 53, 0.1);
        }
        
        .item-sprite {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .info {
            margin: 20px 0;
            padding: 15px;
            background: #1a1a1a;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .info h3 {
            margin: 0 0 10px 0;
            color: #ff6b35;
        }
        
        .info ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .info li {
            margin: 5px 0;
        }
        
        .delete-zone {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: rgba(231, 76, 60, 0.2);
            border: 3px dashed #e74c3c;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            pointer-events: none;
        }
        
        .delete-zone.active {
            display: flex;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
        }
        
        .btn {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: #444;
        }
        
        .btn--primary {
            background: #ff6b35;
            border-color: #ff6b35;
        }
        
        .btn--primary:hover {
            background: #e55a2b;
        }
        
        .btn--outline {
            background: transparent;
            border-color: #666;
        }
        
        .btn--outline:hover {
            background: #333;
        }
    </style>
</head>
<body>
    <div class="inventory-container">
        <h1>–¢–µ—Å—Ç Drag & Drop —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h1>
        
        <div class="info">
            <h3>–°–ø–æ—Å–æ–±—ã —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤:</h3>
            <ul>
                <li><strong>–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é:</strong> –ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ / –î–≤–æ–π–Ω–æ–π —Ç–∞–ø –¥–≤—É–º—è –ø–∞–ª—å—Ü–∞–º–∏ / –î–æ–ª–≥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ</li>
                <li><strong>Drag & Drop:</strong> –ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (–ø–æ—è–≤–∏—Ç—Å—è –∫—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞)</li>
            </ul>
            <p><strong>–í–∞–∂–Ω–æ:</strong> –í—Å–µ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —á–µ—Ä–µ–∑ popup!</p>
        </div>
        
        <div class="inventory-section">
            <h3>–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞</h3>
            <div class="inventory-grid" id="equipGrid">
                <!-- –°–ª–æ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
        
        <div class="inventory-section">
            <h3>–†—é–∫–∑–∞–∫</h3>
            <div class="inventory-grid" id="backpackGrid">
                <!-- –°–ª–æ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- –ó–æ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
    <div class="delete-zone" id="deleteZone">
        <div style="text-align: center; color: #e74c3c; font-size: 2rem;">
            üóëÔ∏è<br>
            <span style="font-size: 1rem;">–í—ã–±—Ä–æ—Å–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</span>
        </div>
    </div>
    
    <!-- Popup –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="deletePopup" class="hidden" style="position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);z-index:20000;background:#222;padding:24px 32px;border-radius:16px;box-shadow:0 4px 32px #000a;color:#fff;display:flex;flex-direction:column;align-items:center;gap:16px;min-width:220px;">
        <div style="font-size:2.2rem;">üóëÔ∏è</div>
        <div style="font-size:1.1rem;">–£–¥–∞–ª–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç?</div>
        <div style="display:flex;gap:16px;">
            <button id="confirmDeleteBtn" class="btn btn--primary">–£–¥–∞–ª–∏—Ç—å</button>
            <button id="cancelDeleteBtn" class="btn btn--outline">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script type="module">
        import { ContextMenuManager } from './js/ui/ContextMenuManager.js';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
        ContextMenuManager.init();
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
        const testItems = {
            // –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞
            'equipment-0': { name: '–û–≥–Ω–µ–Ω–Ω—ã–π –º–µ—á', type: 'weapon', slot: 'weapon', icon: '‚öîÔ∏è', color: '#ff6b35', rarity: 'legendary' },
            'equipment-1': { name: '–õ–µ–¥—è–Ω–∞—è –±—Ä–æ–Ω—è', type: 'armor', slot: 'armor', icon: 'üõ°Ô∏è', color: '#3498db', rarity: 'rare' },
            'equipment-2': { name: '–ö–æ–ª—å—Ü–æ —Å–∏–ª—ã', type: 'accessory', slot: 'accessory', icon: 'üíç', color: '#9b59b6', rarity: 'rare' },
            'equipment-3': { name: '–ó–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è', type: 'consumable', slot: 'consumable', icon: 'üß™', color: '#e74c3c', rarity: 'common' },
            
            // –†—é–∫–∑–∞–∫
            'backpack-0': { name: '–ó–µ–ª—å–µ –º–∞–Ω—ã', type: 'consumable', slot: 'consumable', icon: 'üîÆ', color: '#9b59b6', rarity: 'common' },
            'backpack-1': { name: '–î—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã–π –∫–∞–º–µ–Ω—å', type: 'accessory', slot: 'accessory', icon: 'üíé', color: '#f1c40f', rarity: 'legendary' },
            'backpack-2': { name: '–°–≤–∏—Ç–æ–∫ —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏–∏', type: 'consumable', slot: 'consumable', icon: 'üìú', color: '#e67e22', rarity: 'rare' },
            'backpack-3': { name: '–ö–∏–Ω–∂–∞–ª —Ç–µ–Ω–µ–π', type: 'weapon', slot: 'weapon', icon: 'üó°Ô∏è', color: '#2c3e50', rarity: 'rare' },
            'backpack-4': { name: '–©–∏—Ç –∑–∞—â–∏—Ç–Ω–∏–∫–∞', type: 'armor', slot: 'armor', icon: 'üõ°Ô∏è', color: '#27ae60', rarity: 'common' },
            'backpack-5': { name: '–ê–º—É–ª–µ—Ç –∂–∏–∑–Ω–∏', type: 'accessory', slot: 'accessory', icon: 'üîÆ', color: '#e74c3c', rarity: 'legendary' },
            'backpack-6': { name: '–ó–µ–ª—å–µ —Å–∫–æ—Ä–æ—Å—Ç–∏', type: 'consumable', slot: 'consumable', icon: '‚ö°', color: '#f39c12', rarity: 'common' },
            'backpack-7': { name: '–ú–µ—á —Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª—è', type: 'weapon', slot: 'weapon', icon: '‚öîÔ∏è', color: '#8e44ad', rarity: 'legendary' }
        };
        
        // –°–æ–∑–¥–∞–µ–º —Å–ª–æ—Ç—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
        const equipGrid = document.getElementById('equipGrid');
        for (let i = 0; i < 4; i++) {
            const slot = document.createElement('div');
            slot.className = 'inventory-slot';
            slot.dataset.type = 'equipment';
            slot.dataset.index = i;
            
            const itemKey = `equipment-${i}`;
            const item = testItems[itemKey];
            
            if (item) {
                slot.classList.add('filled', item.rarity);
                slot.innerHTML = `<div class="item-sprite" style="color:${item.color};">${item.icon}</div>`;
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
                ContextMenuManager.setupSlotContextMenu(slot, item, 'equipment', i);
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º drag & drop
                setupDragDrop(slot, item, 'equipment', i);
            }
            
            equipGrid.appendChild(slot);
        }
        
        // –°–æ–∑–¥–∞–µ–º —Å–ª–æ—Ç—ã —Ä—é–∫–∑–∞–∫–∞
        const backpackGrid = document.getElementById('backpackGrid');
        for (let i = 0; i < 8; i++) {
            const slot = document.createElement('div');
            slot.className = 'inventory-slot';
            slot.dataset.type = 'backpack';
            slot.dataset.index = i;
            
            const itemKey = `backpack-${i}`;
            const item = testItems[itemKey];
            
            if (item) {
                slot.classList.add('filled', item.rarity);
                slot.innerHTML = `<div class="item-sprite" style="color:${item.color};">${item.icon}</div>`;
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
                ContextMenuManager.setupSlotContextMenu(slot, item, 'backpack', i);
                
                // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º drag & drop
                setupDragDrop(slot, item, 'backpack', i);
            }
            
            backpackGrid.appendChild(slot);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ drag & drop
        function setupDragDrop(slot, item, type, index) {
            slot.draggable = true;
            
            slot.addEventListener('dragstart', (e) => {
                slot.classList.add('dragging');
                console.log(`–ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è: ${item.name}`);
            });
            
            slot.addEventListener('dragend', (e) => {
                slot.classList.remove('dragging');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –±—ã–ª –ª–∏ –ø—Ä–µ–¥–º–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω –∑–∞ –ø—Ä–µ–¥–µ–ª—ã –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                const inventoryContainer = document.querySelector('.inventory-container');
                const containerRect = inventoryContainer.getBoundingClientRect();
                const mouseX = e.clientX;
                const mouseY = e.clientY;
                
                const isOutside = mouseX < containerRect.left || 
                                mouseX > containerRect.right || 
                                mouseY < containerRect.top || 
                                mouseY > containerRect.bottom;
                
                if (isOutside) {
                    console.log(`–ü—Ä–µ–¥–º–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω –∑–∞ –ø—Ä–µ–¥–µ–ª—ã: ${item.name}`);
                    showDeleteConfirmation(item, { type, index });
                }
            });
            
            slot.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                slot.classList.add('drag-over');
            });
            
            slot.addEventListener('dragleave', () => {
                slot.classList.remove('drag-over');
            });
            
            slot.addEventListener('drop', (e) => {
                e.preventDefault();
                slot.classList.remove('drag-over');
                console.log(`–ü—Ä–µ–¥–º–µ—Ç –ø–æ–º–µ—â–µ–Ω –≤ —Å–ª–æ—Ç: ${item.name}`);
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
        function showDeleteConfirmation(item, slot) {
            const popup = document.getElementById('deletePopup');
            if (!popup) return;

            const confirmBtn = document.getElementById('confirmDeleteBtn');
            const cancelBtn = document.getElementById('cancelDeleteBtn');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç
            const itemName = item ? item.name : '–ø—Ä–µ–¥–º–µ—Ç';
            popup.querySelector('div:nth-child(2)').textContent = `–£–¥–∞–ª–∏—Ç—å "${itemName}"?`;

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            const handleConfirm = () => {
                console.log(`–ü—Ä–µ–¥–º–µ—Ç —É–¥–∞–ª–µ–Ω: ${item.name}`);
                // –í —Ä–µ–∞–ª—å–Ω–æ–π –∏–≥—Ä–µ –∑–¥–µ—Å—å –±—ã–ª–æ –±—ã —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                popup.classList.add('hidden');
                confirmBtn.removeEventListener('click', handleConfirm);
                cancelBtn.removeEventListener('click', handleCancel);
            };

            const handleCancel = () => {
                console.log('–£–¥–∞–ª–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
                popup.classList.add('hidden');
                confirmBtn.removeEventListener('click', handleConfirm);
                cancelBtn.removeEventListener('click', handleCancel);
            };

            confirmBtn.addEventListener('click', handleConfirm);
            cancelBtn.addEventListener('click', handleCancel);

            popup.classList.remove('hidden');
        }
        
        console.log('–¢–µ—Å—Ç –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è —Å drag & drop –∑–∞–≥—Ä—É–∂–µ–Ω');
    </script>
</body>
</html> 