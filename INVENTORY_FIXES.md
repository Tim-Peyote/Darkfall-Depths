# Исправления проблем инвентаря

## Проблема 1: Украшения попадают только в первый слот

### Описание проблемы
Амулеты и кольца всегда размещались в слот "Украшение 1" (индекс 4), даже если слот "Украшение 2" (индекс 6) был свободен.

### Исправления

#### 1. В методе `equipItem()` (InventoryManager.js)
Добавлена специальная логика для украшений:
```javascript
// Специальная логика для украшений - если первый слот занят, используем второй
if (item.type === 'accessory' || item.slot === 'accessory') {
  if (gameState.inventory.equipment[4] && !gameState.inventory.equipment[6]) {
    // Если первый слот украшений занят, а второй свободен, используем второй
    targetSlot = 6;
  } else if (!gameState.inventory.equipment[4]) {
    // Если первый слот свободен, используем его
    targetSlot = 4;
  } else if (gameState.inventory.equipment[4] && gameState.inventory.equipment[6]) {
    // Если оба слота заняты, заменяем первый
    targetSlot = 4;
  }
}
```

#### 2. В методе `handleDrop()` (InventoryManager.js)
Добавлена логика перенаправления украшений:
```javascript
// Специальная логика для украшений - если первый слот занят, используем второй
if (slotConfig.allowedTypes.includes('accessory')) {
  if (to.index === 4 && gameState.inventory.equipment[4] && !gameState.inventory.equipment[6]) {
    // Если первый слот украшений занят, а второй свободен, используем второй
    const actualTo = { type: 'equipment', index: 6 };
    return this.handleDrop(from, actualTo);
  } else if (to.index === 4 && gameState.inventory.equipment[4] && gameState.inventory.equipment[6]) {
    // Если оба слота заняты, разрешаем замену в первом слоте
    // Продолжаем выполнение без изменений
  }
}
```

## Проблема 2: Перетаскивание не работает для слотов экипировки и рюкзака

### Описание проблемы
Обработчики drag & drop добавлялись только к слотам с предметами, но не к пустым слотам экипировки и рюкзака.

### Исправления

#### В методе `renderInventory()` (InventoryManager.js)
Перенесен вызов `setupDragDropForSlot()` за пределы блока проверки наличия предмета для всех типов слотов:

**Для слотов экипировки:**
```javascript
// Настройка drag & drop для всех слотов экипировки (с предметами и без)
this.setupDragDropForSlot(slot, 'equipment', index);

equipmentSlots.appendChild(slot);
```

**Для слотов рюкзака:**
```javascript
// Настройка drag & drop для всех слотов рюкзака (с предметами и без)
this.setupDragDropForSlot(slot, 'backpack', index);

backpackSlots.appendChild(slot);
```

## Результат

✅ **Украшения теперь правильно распределяются между двумя слотами:**
- Если первый слот свободен → используется первый слот
- Если первый слот занят, а второй свободен → используется второй слот
- Если оба слота заняты → заменяется первый слот

✅ **Перетаскивание работает для всех слотов экипировки и рюкзака:**
- Пустые слоты теперь принимают предметы
- Предметы в рюкзаке можно перетаскивать между слотами
- При перетаскивании на пустой слот - предмет перемещается
- При перетаскивании на занятый слот - предметы меняются местами
- Совместимость предметов проверяется при перетаскивании в экипировку
- Визуальная обратная связь при перетаскивании

## Тестирование

1. Откройте игру и инвентарь
2. Попробуйте перетащить амулет или кольцо в слот "Украшение 1"
3. Если первый слот занят, предмет должен автоматически попасть во второй слот
4. Попробуйте перетащить любой предмет в пустые слоты экипировки
5. Попробуйте перетащить предметы внутри рюкзака:
   - Перетащите предмет на пустой слот → предмет должен переместиться
   - Перетащите предмет на занятый слот → предметы должны поменяться местами
6. Попробуйте использовать контекстное меню (правый клик) для надевания предметов

## Файлы изменены

- `js/ui/InventoryManager.js` - основные исправления логики инвентаря
